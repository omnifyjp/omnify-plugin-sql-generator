{"version":3,"sources":["../src/plugin.ts"],"sourcesContent":["/**\n * @famgia/omnify-sql - Plugin\n *\n * Plugin wrapper for SQL migration generator.\n *\n * @example\n * ```typescript\n * import { defineConfig } from '@famgia/omnify';\n * import sql from '@famgia/omnify-sql/plugin';\n *\n * export default defineConfig({\n *   plugins: [\n *     sql({\n *       dialect: 'postgresql',\n *       migrationsPath: 'migrations',\n *     }),\n *   ],\n * });\n * ```\n */\n\nimport type { OmnifyPlugin, GeneratorOutput, GeneratorContext } from '@famgia/omnify-types';\nimport type { SqlDialect, SqlGeneratorOptions } from './types.js';\nimport { generateMigrations, getMigrationPath } from './migration/index.js';\n\n/**\n * Options for the SQL plugin.\n */\nexport interface SqlPluginOptions {\n  /**\n   * SQL dialect to generate.\n   * @default 'mysql'\n   */\n  dialect?: SqlDialect;\n\n  /**\n   * Path for SQL migration files.\n   * @default 'migrations'\n   */\n  migrationsPath?: string;\n\n  /**\n   * Use IF NOT EXISTS in CREATE TABLE.\n   * @default true\n   */\n  ifNotExists?: boolean;\n\n  /**\n   * Include commented DROP TABLE in migrations.\n   * @default true\n   */\n  generateDown?: boolean;\n\n  /**\n   * Starting version number.\n   * @default 1\n   */\n  startVersion?: number;\n\n  /**\n   * Version number padding (e.g., 4 for 0001).\n   * @default 4\n   */\n  versionPadding?: number;\n}\n\n/**\n * Resolved options with defaults.\n */\ninterface ResolvedPluginOptions {\n  dialect: SqlDialect;\n  migrationsPath: string;\n  ifNotExists: boolean;\n  generateDown: boolean;\n  startVersion: number;\n  versionPadding: number;\n}\n\n/**\n * Resolves options with defaults.\n */\nfunction resolveOptions(options?: SqlPluginOptions): ResolvedPluginOptions {\n  return {\n    dialect: options?.dialect ?? 'mysql',\n    migrationsPath: options?.migrationsPath ?? 'migrations',\n    ifNotExists: options?.ifNotExists ?? true,\n    generateDown: options?.generateDown ?? true,\n    startVersion: options?.startVersion ?? 1,\n    versionPadding: options?.versionPadding ?? 4,\n  };\n}\n\n/**\n * Creates the SQL plugin with the specified options.\n *\n * @param options - Plugin configuration options\n * @returns OmnifyPlugin configured for SQL\n */\nexport default function sqlPlugin(options?: SqlPluginOptions): OmnifyPlugin {\n  const resolved = resolveOptions(options);\n\n  return {\n    name: '@famgia/omnify-sql',\n    version: '0.0.1',\n\n    generators: [\n      {\n        name: 'sql-migrations',\n        description: `Generate ${resolved.dialect.toUpperCase()} SQL migration files`,\n\n        generate: async (ctx: GeneratorContext): Promise<GeneratorOutput[]> => {\n          const generatorOptions: SqlGeneratorOptions = {\n            dialect: resolved.dialect,\n            ifNotExists: resolved.ifNotExists,\n            generateDown: resolved.generateDown,\n            startVersion: resolved.startVersion,\n            versionPadding: resolved.versionPadding,\n          };\n\n          const migrations = generateMigrations(ctx.schemas, generatorOptions);\n\n          return migrations.map((migration) => ({\n            path: getMigrationPath(migration, resolved.migrationsPath),\n            content: migration.content,\n            type: 'migration' as const,\n            metadata: {\n              version: migration.version,\n              tables: migration.tables,\n              migrationType: migration.type,\n              dialect: resolved.dialect,\n            },\n          }));\n        },\n      },\n    ],\n  };\n}\n\n// Named export for flexibility\nexport { sqlPlugin };\n"],"mappings":";;;;;;AAiFA,SAAS,eAAe,SAAmD;AACzE,SAAO;AAAA,IACL,SAAS,SAAS,WAAW;AAAA,IAC7B,gBAAgB,SAAS,kBAAkB;AAAA,IAC3C,aAAa,SAAS,eAAe;AAAA,IACrC,cAAc,SAAS,gBAAgB;AAAA,IACvC,cAAc,SAAS,gBAAgB;AAAA,IACvC,gBAAgB,SAAS,kBAAkB;AAAA,EAC7C;AACF;AAQe,SAAR,UAA2B,SAA0C;AAC1E,QAAM,WAAW,eAAe,OAAO;AAEvC,SAAO;AAAA,IACL,MAAM;AAAA,IACN,SAAS;AAAA,IAET,YAAY;AAAA,MACV;AAAA,QACE,MAAM;AAAA,QACN,aAAa,YAAY,SAAS,QAAQ,YAAY,CAAC;AAAA,QAEvD,UAAU,OAAO,QAAsD;AACrE,gBAAM,mBAAwC;AAAA,YAC5C,SAAS,SAAS;AAAA,YAClB,aAAa,SAAS;AAAA,YACtB,cAAc,SAAS;AAAA,YACvB,cAAc,SAAS;AAAA,YACvB,gBAAgB,SAAS;AAAA,UAC3B;AAEA,gBAAM,aAAa,mBAAmB,IAAI,SAAS,gBAAgB;AAEnE,iBAAO,WAAW,IAAI,CAAC,eAAe;AAAA,YACpC,MAAM,iBAAiB,WAAW,SAAS,cAAc;AAAA,YACzD,SAAS,UAAU;AAAA,YACnB,MAAM;AAAA,YACN,UAAU;AAAA,cACR,SAAS,UAAU;AAAA,cACnB,QAAQ,UAAU;AAAA,cAClB,eAAe,UAAU;AAAA,cACzB,SAAS,SAAS;AAAA,YACpB;AAAA,UACF,EAAE;AAAA,QACJ;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;","names":[]}
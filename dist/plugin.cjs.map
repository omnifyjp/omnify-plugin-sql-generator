{"version":3,"sources":["/Users/f.satoshi/Herd/omnify-ts/packages/omnify-plugin-sql-generator/dist/plugin.cjs","../src/plugin.ts"],"names":[],"mappings":"AAAA;AACE;AACA;AACF,wDAA6B;AAC7B;AACA;AC4EA,SAAS,cAAA,CAAe,OAAA,EAAmD;AACzE,EAAA,OAAO;AAAA,IACL,OAAA,mCAAS,OAAA,2BAAS,SAAA,UAAW,SAAA;AAAA,IAC7B,cAAA,mCAAgB,OAAA,6BAAS,gBAAA,UAAkB,cAAA;AAAA,IAC3C,WAAA,mCAAa,OAAA,6BAAS,aAAA,UAAe,MAAA;AAAA,IACrC,YAAA,mCAAc,OAAA,6BAAS,cAAA,UAAgB,MAAA;AAAA,IACvC,YAAA,mCAAc,OAAA,6BAAS,cAAA,UAAgB,GAAA;AAAA,IACvC,cAAA,mCAAgB,OAAA,6BAAS,gBAAA,UAAkB;AAAA,EAC7C,CAAA;AACF;AAQe,SAAR,SAAA,CAA2B,OAAA,EAA0C;AAC1E,EAAA,MAAM,SAAA,EAAW,cAAA,CAAe,OAAO,CAAA;AAEvC,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,oBAAA;AAAA,IACN,OAAA,EAAS,OAAA;AAAA,IAET,UAAA,EAAY;AAAA,MACV;AAAA,QACE,IAAA,EAAM,gBAAA;AAAA,QACN,WAAA,EAAa,CAAA,SAAA,EAAY,QAAA,CAAS,OAAA,CAAQ,WAAA,CAAY,CAAC,CAAA,oBAAA,CAAA;AAAA,QAEvD,QAAA,EAAU,MAAA,CAAO,GAAA,EAAA,GAAsD;AACrE,UAAA,MAAM,iBAAA,EAAwC;AAAA,YAC5C,OAAA,EAAS,QAAA,CAAS,OAAA;AAAA,YAClB,WAAA,EAAa,QAAA,CAAS,WAAA;AAAA,YACtB,YAAA,EAAc,QAAA,CAAS,YAAA;AAAA,YACvB,YAAA,EAAc,QAAA,CAAS,YAAA;AAAA,YACvB,cAAA,EAAgB,QAAA,CAAS;AAAA,UAC3B,CAAA;AAEA,UAAA,MAAM,WAAA,EAAa,kDAAA,GAAmB,CAAI,OAAA,EAAS,gBAAgB,CAAA;AAEnE,UAAA,OAAO,UAAA,CAAW,GAAA,CAAI,CAAC,SAAA,EAAA,GAAA,CAAe;AAAA,YACpC,IAAA,EAAM,gDAAA,SAAiB,EAAW,QAAA,CAAS,cAAc,CAAA;AAAA,YACzD,OAAA,EAAS,SAAA,CAAU,OAAA;AAAA,YACnB,IAAA,EAAM,WAAA;AAAA,YACN,QAAA,EAAU;AAAA,cACR,OAAA,EAAS,SAAA,CAAU,OAAA;AAAA,cACnB,MAAA,EAAQ,SAAA,CAAU,MAAA;AAAA,cAClB,aAAA,EAAe,SAAA,CAAU,IAAA;AAAA,cACzB,OAAA,EAAS,QAAA,CAAS;AAAA,YACpB;AAAA,UACF,CAAA,CAAE,CAAA;AAAA,QACJ;AAAA,MACF;AAAA,IACF;AAAA,EACF,CAAA;AACF;ADtFA;AACE;AACA;AACF,2DAAC","file":"/Users/f.satoshi/Herd/omnify-ts/packages/omnify-plugin-sql-generator/dist/plugin.cjs","sourcesContent":[null,"/**\n * @famgia/omnify-sql - Plugin\n *\n * Plugin wrapper for SQL migration generator.\n *\n * @example\n * ```typescript\n * import { defineConfig } from '@famgia/omnify';\n * import sql from '@famgia/omnify-sql/plugin';\n *\n * export default defineConfig({\n *   plugins: [\n *     sql({\n *       dialect: 'postgresql',\n *       migrationsPath: 'migrations',\n *     }),\n *   ],\n * });\n * ```\n */\n\nimport type { OmnifyPlugin, GeneratorOutput, GeneratorContext } from '@famgia/omnify-types';\nimport type { SqlDialect, SqlGeneratorOptions } from './types.js';\nimport { generateMigrations, getMigrationPath } from './migration/index.js';\n\n/**\n * Options for the SQL plugin.\n */\nexport interface SqlPluginOptions {\n  /**\n   * SQL dialect to generate.\n   * @default 'mysql'\n   */\n  dialect?: SqlDialect;\n\n  /**\n   * Path for SQL migration files.\n   * @default 'migrations'\n   */\n  migrationsPath?: string;\n\n  /**\n   * Use IF NOT EXISTS in CREATE TABLE.\n   * @default true\n   */\n  ifNotExists?: boolean;\n\n  /**\n   * Include commented DROP TABLE in migrations.\n   * @default true\n   */\n  generateDown?: boolean;\n\n  /**\n   * Starting version number.\n   * @default 1\n   */\n  startVersion?: number;\n\n  /**\n   * Version number padding (e.g., 4 for 0001).\n   * @default 4\n   */\n  versionPadding?: number;\n}\n\n/**\n * Resolved options with defaults.\n */\ninterface ResolvedPluginOptions {\n  dialect: SqlDialect;\n  migrationsPath: string;\n  ifNotExists: boolean;\n  generateDown: boolean;\n  startVersion: number;\n  versionPadding: number;\n}\n\n/**\n * Resolves options with defaults.\n */\nfunction resolveOptions(options?: SqlPluginOptions): ResolvedPluginOptions {\n  return {\n    dialect: options?.dialect ?? 'mysql',\n    migrationsPath: options?.migrationsPath ?? 'migrations',\n    ifNotExists: options?.ifNotExists ?? true,\n    generateDown: options?.generateDown ?? true,\n    startVersion: options?.startVersion ?? 1,\n    versionPadding: options?.versionPadding ?? 4,\n  };\n}\n\n/**\n * Creates the SQL plugin with the specified options.\n *\n * @param options - Plugin configuration options\n * @returns OmnifyPlugin configured for SQL\n */\nexport default function sqlPlugin(options?: SqlPluginOptions): OmnifyPlugin {\n  const resolved = resolveOptions(options);\n\n  return {\n    name: '@famgia/omnify-sql',\n    version: '0.0.1',\n\n    generators: [\n      {\n        name: 'sql-migrations',\n        description: `Generate ${resolved.dialect.toUpperCase()} SQL migration files`,\n\n        generate: async (ctx: GeneratorContext): Promise<GeneratorOutput[]> => {\n          const generatorOptions: SqlGeneratorOptions = {\n            dialect: resolved.dialect,\n            ifNotExists: resolved.ifNotExists,\n            generateDown: resolved.generateDown,\n            startVersion: resolved.startVersion,\n            versionPadding: resolved.versionPadding,\n          };\n\n          const migrations = generateMigrations(ctx.schemas, generatorOptions);\n\n          return migrations.map((migration) => ({\n            path: getMigrationPath(migration, resolved.migrationsPath),\n            content: migration.content,\n            type: 'migration' as const,\n            metadata: {\n              version: migration.version,\n              tables: migration.tables,\n              migrationType: migration.type,\n              dialect: resolved.dialect,\n            },\n          }));\n        },\n      },\n    ],\n  };\n}\n\n// Named export for flexibility\nexport { sqlPlugin };\n"]}